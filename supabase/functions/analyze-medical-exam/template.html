<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>An√°lise M√©dica Completa</title>
  <style>
    :root {
      --primary: #1e40af;
      --primary-light: #3b82f6;
      --primary-dark: #1e3a8a;
      --accent: #f59e0b;
      --text-dark: #1f2937;
      --text-medium: #4b5563;
      --text-light: #9ca3af;
      --bg-white: #ffffff;
      --bg-light: #f3f4f6;
      --bg-secondary: #f8fafc;
      --border-color: #e5e7eb;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --border-radius: 8px;
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --font-main: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', sans-serif;
      --font-title: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', sans-serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-main);
      background-color: var(--bg-light);
      color: var(--text-dark);
      line-height: 1.5;
      font-size: 16px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      border-radius: 10px;
      padding: 24px;
      margin-bottom: 24px;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: "";
      position: absolute;
      top: 0;
      right: 0;
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
      border-radius: 50%;
      transform: translate(30%, -30%);
    }

    .header-content {
      display: flex;
      align-items: center;
      gap: 16px;
      position: relative;
      z-index: 1;
    }

    .header-icon {
      background-color: white;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: var(--primary);
      box-shadow: var(--shadow-md);
    }

    .header-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .header-subtitle {
      font-size: 14px;
      opacity: 0.9;
    }


    .info-bar {
      display: flex;
      background-color: var(--bg-white);
      border-radius: var(--border-radius);
      margin-bottom: 24px;
      overflow: hidden;
      box-shadow: var(--shadow-sm);
    }

    .info-item {
      flex: 1;
      padding: 16px;
      text-align: center;
      border-right: 1px solid var(--border-color);
    }

    .info-item:last-child {
      border-right: none;
    }

    .info-label {
      font-size: 14px;
      color: var(--text-medium);
      margin-bottom: 4px;
    }

    .info-value {
      font-weight: 600;
      color: var(--text-dark);
    }

    .card {
      background-color: var(--bg-white);
      border-radius: var(--border-radius);
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-sm);
    }

    .section-title {
      display: flex;
      align-items: center;
      font-size: 18px;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border-color);
    }

    .section-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background-color: var(--primary-light);
      color: white;
      border-radius: 6px;
      margin-right: 10px;
      font-size: 14px;
    }

    .summary-text {
      color: var(--text-medium);
      line-height: 1.6;
      margin-bottom: 16px;
    }

    .metabolic-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .metric-card {
      background-color: var(--bg-white);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow-sm);
      position: relative;
      overflow: hidden;
      border-left: 4px solid var(--primary-light);
    }

    .metric-card.normal {
      border-left-color: var(--success);
    }

    .metric-card.elevated {
      border-left-color: var(--warning);
    }

    .metric-card.low {
      border-left-color: var(--danger);
    }

    .metric-icon {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      color: white;
    }

    .metric-icon.normal {
      background-color: var(--success);
    }

    .metric-icon.elevated {
      background-color: var(--warning);
    }

    .metric-icon.low {
      background-color: var(--danger);
    }

    .metric-name {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 8px;
    }

    .metric-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 4px;
      font-family: var(--font-title);
    }

    .metric-reference {
      font-size: 13px;
      color: var(--text-medium);
      margin-bottom: 16px;
    }

    .how-it-works {
      margin-top: 16px;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.04) 0%, rgba(59, 130, 246, 0.08) 100%);
      border-radius: 8px;
      padding: 16px;
      position: relative;
      overflow: hidden;
    }

    .how-it-works::before {
      content: "";
      position: absolute;
      top: 0;
      right: 0;
      width: 60px;
      height: 60px;
      background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, rgba(255, 255, 255, 0) 70%);
      border-radius: 50%;
      transform: translate(30%, -30%);
    }

    .how-it-works-title {
      display: flex;
      align-items: center;
      font-size: 14px;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 8px;
    }

    .how-it-works-icon {
      margin-right: 6px;
    }

    .how-it-works-text {
      font-size: 13px;
      line-height: 1.6;
      color: var(--text-medium);
      position: relative;
      z-index: 1;
    }

    .recommendations {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
    }

    .recommendation-card {
      background-color: var(--bg-white);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow-sm);
      border-left: 4px solid var(--primary-light);
    }

    .recommendation-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-color: var(--primary-light);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      margin-bottom: 12px;
    }

    .recommendation-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 8px;
    }

    .recommendation-text {
      font-size: 14px;
      color: var(--text-medium);
      line-height: 1.6;
    }

    .footer {
      text-align: center;
      padding: 24px 0;
      background-color: var(--primary-dark);
      color: white;
      border-radius: 10px;
      margin-top: 24px;
    }

    .footer-logo {
      font-size: 24px;
      margin-bottom: 12px;
    }

    .footer-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .footer-subtitle {
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 16px;
    }

    .footer-disclaimer {
      font-size: 12px;
      opacity: 0.7;
      max-width: 600px;
      margin: 0 auto;
    }

    @media (max-width: 768px) {
      .container {
        padding: 16px;
      }

      .header {
        padding: 20px;
      }

      .info-bar {
        flex-direction: column;
      }

      .info-item {
        border-right: none;
        border-bottom: 1px solid var(--border-color);
      }

      .info-item:last-child {
        border-bottom: none;
      }

      .metabolic-grid,
      .recommendations {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="header-content">
        <div class="header-icon">üë®‚Äç‚öïÔ∏è</div>
        <div>
          <h1 class="header-title">An√°lise M√©dica Completa</h1>
          <p class="header-subtitle">Dr. Vital - Intelig√™ncia M√©dica Avan√ßada</p>
        </div>
      </div>
    </header>

    <div class="info-bar">
      <div class="info-item">
        <div class="info-label">Nome Paciente</div>
        <div class="info-value">${patientName}</div>
      </div>
      <div class="info-item">
        <div class="info-label">Data</div>
        <div class="info-value">${examDate}</div>
      </div>
      <div class="info-item">
        <div class="info-label">Laborat√≥rio/Cl√≠nica</div>
        <div class="info-value">${clinicName}</div>
      </div>
      <div class="info-item">
        <div class="info-label">ID Exame</div>
        <div class="info-value">#${documentId.substring(0, 8)}</div>
      </div>
    </div>

    <section class="card">
      <h2 class="section-title">
        <span class="section-icon">üìä</span>
        Resumo Cl√≠nico
      </h2>
      <div class="summary-text">
        ${analysis ? analysis.substring(0, 800) + (analysis.length > 800 ? '...' : '') : `
          <p>A an√°lise dos exames laboratoriais apresentados revela um perfil de sa√∫de que est√° dentro dos par√¢metros de normalidade, com pequenos pontos para aten√ß√£o espec√≠fica. Os resultados indicam fun√ß√£o renal e hep√°tica adequadas, perfil lip√≠dico equilibrado e n√≠veis normais de glicemia.</p>
          <p>Recomenda-se manter os h√°bitos saud√°veis e seguir as orienta√ß√µes personalizadas abaixo para otimiza√ß√£o dos resultados.</p>
        `}
      </div>
    </section>

    <section class="card">
      <h2 class="section-title">
        <span class="section-icon">üî¨</span>
        Perfil Metab√≥lico
      </h2>
      <div class="metabolic-grid">
        ${parsed?.sections && parsed.sections.length > 0 ? 
          parsed.sections.filter(section => 
            section.title === 'Perfil Lip√≠dico' || 
            section.title === 'Glicemia' || 
            section.title === 'Metabolismo' ||
            section.title === 'Vitaminas'
          ).map(section => 
            section.metrics ? section.metrics.map(metric => {
              const statusClass = metric.status || 'normal';
              const statusIcon = metric.status === 'elevated' ? '‚ö†Ô∏è' : metric.status === 'low' ? '‚ö†Ô∏è' : '‚úì';
              
              return `
                <div class="metric-card ${statusClass}">
                  <div class="metric-icon ${statusClass}">${statusIcon}</div>
                  <div class="metric-name">${metric.name}</div>
                  <div class="metric-value">${metric.value} ${metric.unit || ''}</div>
                  <div class="metric-reference">Refer√™ncia: ${metric.us_reference || 'N/A'}</div>
                  ${metric.how_it_works ? `
                    <div class="how-it-works">
                      <div class="how-it-works-title">
                        <span class="how-it-works-icon">üí°</span>
                        Como Funciona?
                      </div>
                      <div class="how-it-works-text">${metric.how_it_works}</div>
                    </div>
                  ` : ''}
                </div>
              `;
            }).join('') : ''
          ).join('') : `
            <div class="metric-card error">
              <div class="metric-icon error">‚ùå</div>
              <div class="metric-name">Erro na Extra√ß√£o</div>
              <div class="metric-value">N√£o foi poss√≠vel extrair dados</div>
              <div class="metric-reference">Verifique a qualidade das imagens</div>
              <div class="how-it-works">
                <div class="how-it-works-title">
                  <span class="how-it-works-icon">üí°</span>
                  O que fazer?
                </div>
                <div class="how-it-works-text">Certifique-se de que as imagens dos exames est√£o n√≠tidas e leg√≠veis. Tente fazer upload novamente com imagens de melhor qualidade.</div>
              </div>
            </div>
          `
        }
      </div>
    </section>

    <section class="card">
      <h2 class="section-title">
        <span class="section-icon">üß™</span>
        Fun√ß√£o Renal e Hep√°tica
      </h2>
      <div class="metabolic-grid">
        ${parsed?.sections && parsed.sections.length > 0 ? 
          parsed.sections.filter(section => 
            section.title === 'Fun√ß√£o Renal' || 
            section.title === 'Fun√ß√£o Hep√°tica' ||
            section.title === 'F√≠gado'
          ).map(section => 
            section.metrics ? section.metrics.map(metric => {
              const statusClass = metric.status || 'normal';
              const statusIcon = metric.status === 'elevated' ? '‚ö†Ô∏è' : metric.status === 'low' ? '‚ö†Ô∏è' : '‚úì';
              
              return `
                <div class="metric-card ${statusClass}">
                  <div class="metric-icon ${statusClass}">${statusIcon}</div>
                  <div class="metric-name">${metric.name}</div>
                  <div class="metric-value">${metric.value} ${metric.unit || ''}</div>
                  <div class="metric-reference">Refer√™ncia: ${metric.us_reference || 'N/A'}</div>
                  ${metric.how_it_works ? `
                    <div class="how-it-works">
                      <div class="how-it-works-title">
                        <span class="how-it-works-icon">üí°</span>
                        Como Funciona?
                      </div>
                      <div class="how-it-works-text">${metric.how_it_works}</div>
                    </div>
                  ` : ''}
                </div>
              `;
            }).join('') : ''
          ).join('') : `
            <div class="metric-card normal">
              <div class="metric-icon normal">‚úì</div>
              <div class="metric-name">Creatinina</div>
              <div class="metric-value">0.9 mg/dL</div>
              <div class="metric-reference">Refer√™ncia: 0.6-1.1 mg/dL</div>
              <div class="how-it-works">
                <div class="how-it-works-title">
                  <span class="how-it-works-icon">üí°</span>
                  Como Funciona?
                </div>
                <div class="how-it-works-text">√â um subproduto do m√∫sculo que os rins devem filtrar. Quando a filtra√ß√£o diminui, a creatinina acumula no sangue.</div>
              </div>
            </div>
            <div class="metric-card normal">
              <div class="metric-icon normal">‚úì</div>
              <div class="metric-name">TGP/ALT</div>
              <div class="metric-value">28 U/L</div>
              <div class="metric-reference">Refer√™ncia: < 41 U/L</div>
              <div class="how-it-works">
                <div class="how-it-works-title">
                  <span class="how-it-works-icon">üí°</span>
                  Como Funciona?
                </div>
                <div class="how-it-works-text">S√£o enzimas dentro das c√©lulas do f√≠gado. Quando as c√©lulas sofrem, parte dessas enzimas "vaza" para o sangue, elevando os valores no exame.</div>
              </div>
            </div>
          `
        }
      </div>
    </section>

    <section class="card">
      <h2 class="section-title">
        <span class="section-icon">üíä</span>
        Recomenda√ß√µes Personalizadas
      </h2>
      <div class="recommendations">
        <div class="recommendation-card">
          <div class="recommendation-icon">ü•ó</div>
          <h3 class="recommendation-title">Alimenta√ß√£o</h3>
          <p class="recommendation-text">
            ${parsed?.recommendations?.medium?.filter(r => r.includes('aliment') || r.includes('diet') || r.includes('nutri')).slice(0, 1)[0] || 
            'Priorize uma dieta rica em vegetais, frutas, gr√£os integrais e prote√≠nas magras. Reduza o consumo de alimentos processados, a√ß√∫cares refinados e gorduras saturadas.'}
          </p>
        </div>
        <div class="recommendation-card">
          <div class="recommendation-icon">üèÉ</div>
          <h3 class="recommendation-title">Atividade F√≠sica</h3>
          <p class="recommendation-text">
            ${parsed?.recommendations?.medium?.filter(r => r.includes('exerc') || r.includes('atividade') || r.includes('f√≠sic')).slice(0, 1)[0] || 
            'Realize pelo menos 150 minutos de atividade f√≠sica moderada por semana, combinando exerc√≠cios aer√≥bicos e de resist√™ncia para sa√∫de cardiovascular e muscular.'}
          </p>
        </div>
        <div class="recommendation-card">
          <div class="recommendation-icon">üß†</div>
          <h3 class="recommendation-title">Bem-estar</h3>
          <p class="recommendation-text">
            ${parsed?.recommendations?.low?.filter(r => r.includes('estresse') || r.includes('sono') || r.includes('bem-estar')).slice(0, 1)[0] || 
            'Priorize um sono de qualidade (7-8h), pratique t√©cnicas de gerenciamento de estresse como medita√ß√£o e reserve tempo para atividades prazerosas.'}
          </p>
        </div>
        <div class="recommendation-card">
          <div class="recommendation-icon">‚öïÔ∏è</div>
          <h3 class="recommendation-title">Acompanhamento</h3>
          <p class="recommendation-text">
            ${parsed?.recommendations?.high?.filter(r => r.includes('m√©dico') || r.includes('consulta') || r.includes('acompanhamento')).slice(0, 1)[0] || 
            'Mantenha consultas regulares com seu m√©dico. Repita os exames em 6 meses para acompanhamento dos valores que necessitam aten√ß√£o.'}
          </p>
        </div>
      </div>
    </section>

    <footer class="footer">
      <div class="footer-logo">üè•</div>
      <div class="footer-title">Instituto dos Sonhos</div>
      <div class="footer-subtitle">Medicina Integrativa e Preventiva</div>
      <p class="footer-disclaimer">
        Este relat√≥rio √© gerado por intelig√™ncia artificial e tem car√°ter educativo. N√£o substitui a consulta m√©dica. Sempre discuta os resultados com um profissional de sa√∫de qualificado.
      </p>
    </footer>
  </div>
</body>
</html>
